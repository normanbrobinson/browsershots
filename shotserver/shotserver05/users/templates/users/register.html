<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Register a new user account</title>
<link rel="stylesheet" type="text/css" href="/static/css/style.css" />
{{ form.media }}
<script type="text/javascript">

function validated(data) {
  for (var field in data) {
    $("#error_" + field).text(data[field]);
  }
}

function validate(event) {
  $.post("/users/validate/" + this.name + "/",
	 $("#register_form").formToArray(),
	 validated, "json");
}

function recommend(event) {
  if ($("#id_username").val()) return;
  first = $("#id_first_name").val();
  last = $("#id_last_name").val();
  username = first + last;
  username = username.toLowerCase();
  username = username.replace('Ä', 'ae');
  username = username.replace('Ö', 'oe');
  username = username.replace('Ü', 'ue');
  username = username.replace('ä', 'ae');
  username = username.replace('ö', 'oe');
  username = username.replace('ü', 'ue');
  username = username.replace('ß', 'ss');
  username = username.replace(/\W/g, '');
  $("#id_username").val(username);
}

$(document).ready(function() {
  $("#id_{{ form_focus }}").focus();
  $("#id_username").focus(recommend);
  $("input").keyup(validate);
  $("input").change(validate);
});

</script>
</head>
<body>
<form id="register_form" method="post" action="/users/register/">
{% for field in form %}
<p><label for="id_{{ field.name }}">{{ field.label }}:</label>
{{ field }}
<span id="error_{{ field.name }}" class="error">{{ field.errors.0 }}</span></p>
{% endfor %}
<p><input type="submit" id="id_submit" /></p>
</form>
</body>
</html>
